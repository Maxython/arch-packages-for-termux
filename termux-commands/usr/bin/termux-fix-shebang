#!/data/data/com.termux/files/usr/bin/bash
if [ `/system/bin/getconf LONG_BIT` = "64" ]; then
        export LD_LIBRARY_PATH="/system/lib64" LIBRARY_PATH="/system/lib64"
else
        export LD_LIBRARY_PATH="/system/lib" LIBRARY_PATH="/system/lib"
fi
export PATH="/system/bin"

if [ $# = 0 -o "$1" = "-h" ]; then
	echo 'usage: termux-fix-shebang <files>'
	echo 'Rewrite shebangs in specified files for running under Termux,'
	echo 'which is done by rewriting #!*/bin/binary to #!/data/data/com.termux/files/usr/bin/binary.'
	exit 1
fi

for file in "$@"; do
	sed -i -E "1 s@^#\!(.*)/[sx]?bin/(.*)@#\!/data/data/com.termux/files/usr/bin/\2@" "$(realpath "${file}")"
done
